packages:
  yum:
    mysql-devel: []

files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/10_migrate.sh":
    mode: "000755"
    owner: root
    group: root
    content: "
      #!/bin/bash
      if [ -f /tmp/leader_only ]; then
        echo 'Running migrations'
        cd /opt/python
        docker exec `docker ps -a -q | head -n 1` run/venv/bin/python current/app/manage.py migrate
      fi
    "
  "/opt/elasticbeanstalk/hooks/appdeploy/post/90_rm_leader_only.sh":
    mode: "000755"
    owner: root
    group: root
    content: "
      #!/bin/bash
      if [ -f /tmp/leader_only ]; then
        echo 'Deleting leader_only file'
        rm /tmp/leader_only
      fi
    "

container_commands:
  01_touch_the_leader:
    command: "#!/bin/bash\ntouch /tmp/leader_only"
    leader_only: true

option_settings:
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_MODULE: "Orpose.settings.production"
  aws:elasticbeanstalk:container:python:
    WSGIPath: Orpose/wsgi.py